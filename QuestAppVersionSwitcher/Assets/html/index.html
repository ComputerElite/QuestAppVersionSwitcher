<html>
<head>
    <title>Quest App Version Switcher - Main</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,400italic,700,700italic' rel='stylesheet' type='text/css'>
</head>
<body>
    
    <div class="menuContainer">
        <div class="sidebar">
            <div class="header">
                <div style="width: 100%;">Welcome to Quest App Version Switcher</div>
                <div style="font-size: 80%; width: 100%;">
                    Managing <div class="inline packageName">some game</div>
                </div>
                <div class="button" style="margin-top: 5px;" onclick="LaunchApp()">Launch Game</div>
            </div>
            <div class="menuItem selected" section="backup">Backup</div>
            <div class="menuItem" section="downgrade">Downgrade
                <div class="button" id="reloadDowngradeIframe" onclick="ReloadDowngradeIFrame()">Reload</div></div>
            <div class="menuItem" section="download">Download progress</div>
            <div class="menuItem" section="patching">Mod my game</div>
            <div class="menuItem" section="mods" id="modsButton">Installed Mods</div>
            <div class="menuItem" section="cosmetics" id="cosmeticsButton">Cosmetics & more</div>
            <div class="menuItem" section="getMods" id="getModsButton">Get Mods & cosmetics</div>
            <div class="menuItem" section="tools">Tools & Options</div>
        </div>
        <div class="content">
            <div class="contentItem hidden" id="patching">
                <div class="button" id="changeApp3">Change app</div>
                <br>
                <div>Currently selected game: <b class="inline packageName">some game</b></div>
                <div id="selectedBackup"></div>
                <br>
                <div id="patchStatus">Loading...</div>
                <div class="textbox" id="patchingTextBox"></div>
                <br>
                <br>
                <div id="patchingOptions">
                    <h3>Patching options</h3>
                    <label class="option">
                        <label class="switch normal">
                            <input id="externalstorage" type="checkbox" checked>
                            <span class="slider round"></span>
                        </label>
                        Add external storage permission
                    </label>
                    <br>
                    <label class="option">
                        <label class="switch normal">
                            <input id="mic" type="checkbox" checked>
                            <span class="slider round"></span>
                        </label>
                        Microphone permission
                    </label>
                    <br>
                    <label class="option">
                        <label class="switch normal">
                            <input id="debug" type="checkbox" checked>
                            <span class="slider round"></span>
                        </label>
                        Add Debug option
                    </label>
                    <br>
                    <label class="option">
                        <label class="switch normal">
                            <input id="handtracking" type="checkbox" checked>
                            <span class="slider round"></span>
                        </label>
                        Add hand tracking permission
                    </label>
                    <br>
                    <label class="option" style="margin-left: 10px;">
                        <b>Hand tracking version</b>
                        <select style="margin-left: 20px; width: auto" class="inline" id="handtrackingversion">
                            <option value="0">Default (recommended)</option>
                            <option value="3">V2</option>
                            <option value="4">V2.1</option>
                        </select>
                    </label>
                    <br>
                    <label class="option">
                        <label class="switch normal">
                            <input id="openxr" type="checkbox" checked>
                            <span class="slider round"></span>
                        </label>
                        Add OpenXR Permission
                    </label>
                    <br>
                    <h4>Custom Permissions</h4>
                    <br>
                    <input type="text" id="otherName" placeholder="permission name">
                    <br>
                    <br>
                    <div class="button" onclick="AddPermission()">Add Permission</div>
                    <br>
                    <div id="other">
                    </div>
                    <h4>Features</h4>
                    <div class="button" onclick="AddSpecificFeature('com.oculus.feature.PASSTHROUGH', true)">Add Passthrough Feature</div>
                    <br>
                    <br>
                    <input type="text" id="featureName" placeholder="feature name">
                    <br>
                    <br>
                    <label class="option">
                        <label class="switch normal">
                            <input id="requireFeature" type="checkbox" checked>
                            <span class="slider round"></span>
                        </label>
                        Require feature
                    </label>
                    <br>
                    <br>
                    <div class="button" onclick="AddFeature()">Add Feature</div>
                    <br>
                    <div id="otherFeatures">
                    </div>
                </div>
                
            </div>
            <div class="contentItem hidden" id="mods">
                <b>Please note that mod installation is in early access and there may be issues. If you experience issues please report them on the OculusDB Discord Server at <code>discord.gg/zwRfHQN2UY</code></b>
                <div class="button topMargin" onclick="LaunchApp()">Launch Game</div>
                <div class="button topButtonMargin" id="installModButton" onclick="UploadMod()">Install a Mod from Disk</div>
                <div class="button topButtonMargin" style="font-size: 1.5rem" onclick="OpenTab('getMods')">Get mods</div>
                <div id="operations">
                    <h2 id="ongoingCount">Ongoing operations:</h2>
                    <div class="loaderContainer" style="margin-bottom: 10px;">
                        <div class="loaderBarRight"></div>
                        <div class="loaderBarLeft"></div>
                        <div class="loaderBarTop"></div>
                        <div class="loaderBarBottom"></div>
                        <div class="loaderSpinningCircle"></div>
                        <div class="loaderMiddleCircle"></div>
                        <div class="loaderCircleHole"></div>
                        <div class="loaderSquare"></div>
                    </div>
                    <div class="infiniteList" id="operationsList">
                        ${operations}
                    </div>
                </div>
                <h2>Installed Mods</h2>
                <div class="infiniteList" id="modsList">

                </div>
                <h2>Installed Libraries</h2>
                <div class="infiniteList" id="libsList">

                </div>
            </div>
            <div class="contentItem hidden" id="cosmetics">

                <div class="buttonContainer"><div class="button" onclick="LaunchApp()">Launch Game</div></div>
                <div class="buttonContainer"><div class="button" id="installCosmeticButton" onclick="InstallCosmetic()">Install a Cosmetic from Disk</div></div>
                <h2>Cosmetics type</h2>
                <select id="cosmeticsType">

                </select>
                <div id="availableAfterModdingTypes" style="display: none;">Types available after modding: </div>
                <div class="infiniteList topMargin" id="cosmeticsList">

                </div>
            </div>
            <div class="contentItem hidden" id="getMods">
                <h2>You can download mods and cosmetics from the following sites. Only QMods are supported by QuestAppVersionSwitcher + any cosmetics formats of the currently selected game</h2>
                <div style="display: flex; flex-direction: column;" class="buttonsContainer">
                    <div class="button labelMargin" onclick="OpenSite(`https://computerelite.github.io/tools/Beat_Saber/questmods.html?version=${currentGameVersion}&isqavs=true&port=${GetPort()}&ismodded=${isGamePatched}`)">Open Beat Saber Mods page</div>
                    <div class="button labelMargin" onclick="OpenSite(`https://computerelite.github.io/tools/Oculus/QAVSHome.html?version=${currentGameVersion}&isqavs=true&port=${GetPort()}&ismodded=${isGamePatched}`)">Open website hub</div>
                    <div class="button labelMargin" onclick="OpenSite(`https://www.google.com/search?q=computerelite`)">Open Google</div>
                </div>
            </div>

            <div class="contentItem" id="backup">
                <div class="contentHeader">
                    Backup
                    <div class="contentHeaderDescription">Backup your game and restore backups</div>
                </div>
                <div class="buttonContainer">
                    <div class="button" id="changeApp2">Change app</div>
                    <div class="buttonLabel">Change the app you want to manage</div>
                </div>
                <div class="topMargin">Backups of <div class="inline packageName">some game</div> (<div id="size" class="inline"></div>)</div>
                <div id="backupList" class="list">
                </div>


                <div class="contentHeader headerMargin">
                    Restore backups
                    <div class="contentHeaderDescription">Restores the backup selected above</div>
                    <br>
                    <b class="hidden" id="onPcInfo">You can only restore backups in headset</b>
                    <label><input type="checkbox" id="restoreAppData" value="only restore app data" style="width: auto;">Only restore app data</label>
                    <div class="buttonContainer">
                        <div class="button" id="restoreBackup">Restore backup</div>
                        <div class="buttonLabel">Restores the selected backup</div>
                    </div>
                    <div class="buttonContainer">
                        <div class="button" id="deleteBackup">Delete backup</div>
                        <div class="buttonLabel">Deletes the selected backup</div>
                    </div>
                    <div id="restoreTextBox" class="textBox"></div>
                </div>

                <div class="contentHeader headerMargin">
                    Create backups
                    <div class="contentHeaderDescription">Change the app at the top</div>
                </div>
                <div>
                    <input type="text" placeholder="Backup Name" id="backupname">
                    <div class="buttonContainer">
                        <div class="button" id="createBackup">Create backup</div>
                        <div class="buttonLabel">Creates a backup of <div class="inline packageName">some game</div></div>
                    </div>
                    <label><input type="checkbox" id="appdata" value="only backup app data" style="width: auto;">Only backup app data</label>
                    <div id="backupTextBox" class="textBox"></div>
                </div>
            </div>
            <div class="contentItem hidden" style="padding: 0px; position: relative" id="downgrade" style="padding: 0px;">
                <b style="font-size: 4em;" id="downgradeLoginMsg">To downgrade you must first log in in the tools & options tab!</b>
                <iframe id="downgradeframe" src=""></iframe>
            </div>
            <div class="contentItem hidden" id="download">
                <h2>Game Downloads</h2>
                <div id="gameProgressBarContainers" style="width: 95%;">

                </div>
                <h2>Downloads</h2>
                <div id="progressBarContainers" style="width: 95%;">

                </div>
            </div>
            <div class="contentItem hidden" id="tools">
                <div class="about">
                    Quest App Version Switcher version <b id="version"></b> by ComputerElite<br>
                    Accessible via browser at:
                    <div id="ips">

                    </div>
                </div>
                <div class="contentHeader">
                    Tools
                    <div class="contentHeaderDescription">Useful for troubleshooting and managing your install</div>
                </div>
                <div class="buttonContainer">
                    <div class="button" id="setup">Open Setup</div>
                    <div class="buttonLabel">Opens the setup assistant</div>
                </div>
                <div class="buttonContainer">
                    <div class="button" id="uninstall">Uninstall app</div>
                    <div class="buttonLabel">Uninstalls the app you selected (needs to be confirmed on android device)</div>
                </div>
                <div class="buttonContainer">
                    <div class="button" id="changeApp">Change app</div>
                    <div class="buttonLabel">Change the app you want to manage</div>
                </div>
                <div class="buttonContainer" id="requestAppManage">
                    <div class="button" id="requestManageStorageAppPermission">Allow manage storage permission for selected app</div>
                    <div class="buttonLabel">Opens settings to allow manage storage for the selected app</div>
                </div>
                <div class="buttonContainer">
                    <div class="button" id="reloadMods">Reload mods</div>
                    <div class="buttonLabel">Reloads installed mods</div>
                </div>
                <div class="buttonContainer">
                    <div class="button" id="checkUpdate">Check for QuestAppVersionSwitcher updates</div>
                    <div class="buttonLabel">Checks if updates for QuestAppVersionSwitcher exist</div>
                </div>
                <div class="buttonContainer">
                    <div class="button" id="deleteAllMods">Delete all mods</div>
                    <div class="buttonLabel">Disables and deletes all mods from the currently selected game</div>
                </div>
                <div class="buttonContainer">
                    <div class="button" onclick="InstallAPKFromDisk()">Install apk from disk</div>
                    <div class="buttonLabel">Opens a file picker to install any apk on your quest</div>
                </div>
                <div id="updateTextBox" class="textBox"></div>

                <div class="space">
                    <div class="contentHeader">
                        Login Section
                        <div class="contentHeaderDescription">Login for downgrading games</div>
                    </div>
                    <b id="loggedInMsg" style="font-size: 1.4em;">You are logged in. You can login again if you want to reset your password.</b>
                    <div class="buttonContainer">
                        <div class="button" id="login">Login</div>
                        <div class="buttonLabel">Log in with your Oculus/Facebook account to downgrade games (<b>ONLY WORKS ON QUEST, NOT ON PC</b>)</div>
                    </div>
                    <div class="buttonContainer">
                        <div class="button" id="logout">Logout</div>
                        <div class="buttonLabel">Logged in with the wrong account? Log out of the account you're signed in here</div>
                    </div>
                    <div class="headerMargin"><a onclick="document.getElementById('tokenLoginContainer').style.display = 'block'" class="underline">Other login methods</a></div>
                    <div id="tokenLoginContainer" style="display: none;">
                        <div class="buttonContainer">
                            <input type="password" id="tokeninput" placeholder="Token">
                            <div class="button" id="logintoken">Login with token</div>
                            <div class="buttonLabel">Log in with your Oculus token to downgrade games (Open this page on PC or phone to paste your token; Type the link shown at the top of this page in your browser)</div>
                        </div>
                        <a href="https://computerelite.github.io/tools/Oculus/ObtainToken.html">Guide to get your token</a>
                        <div id="tokenTextBox" class="textBox"></div>
                    </div>
                </div>

                <div class="space">
                    <div class="contentHeader">
                        Server control
                        <div class="contentHeaderDescription">Configure the QuestAppVersionSwitcher WebServer</div>
                    </div>
                    <div class="buttonContainer">
                        <div class="button" id="exit">Exit</div>
                        <div class="buttonLabel">Exits QuestAppVersionSwitcher</div>
                    </div>
                    <div class="buttonContainer">
                        <input type="number" placeholder="50002" id="port" class="buttonLabel" value="50002" style="width: 100px;">
                        <div class="button" id="confirmPort">Change port</div>
                        <div class="buttonLabel">Changes the WebServer port</div>
                    </div>
                    <div id="serverTextBox" class="textBox"></div>
                </div>

                <div class="space">
                    <div class="contentHeader">
                        Help
                        <div class="contentHeaderDescription">Utilities to help debugging QuestAppVersionSwitcher</div>
                    </div>
                    <div class="buttonContainer">
                        <input type="password" placeholder="Enter QuestAppVersionSwitcher password" id="logspwd" class="buttonLabel" value="" style="width: 300px;">
                        <div class="button" id="logs">Upload logs</div>
                        <div class="buttonLabel">ONLY do when instructed to do so. Uploads which apps you own to OculusDB for viewing by support members. <a href="https://github.com/ComputerElite/QuestAppVersionSwitcher/wiki/What-does-upload-logs-do">More info</a></div>
                    </div>
                    <div id="logsText" class="textBox"></div>
                </div>

                <div class="space">
                    All backups take up <b class="inline totalSize"></b> of space on your device in total.
                    <br>
                    You can delete backups in the <code>Backup</code> section
                </div>
            </div>
        </div>

        <div class="listContainer darken hidden" id="getPasswordContainer">
            <div class="restoreStep" id="step7">
                <div class="contentHeader headerMargin">
                    Password needed
                </div>
                Please enter the password you set when you logged in. If you didn't set one you can leave this field empty and press <code>Start download</code>
                <br>
                <br>
                <i>If you forgot your password abort the download and head to the <code>Tools & Options</code> section to log in again.</i>
                <input type="password" id="passwordConfirm" placeholder="password">
                <div id="step7box" class="textBox"></div>
                <div class="buttonSelectionContainer">
                    <div class="buttonContainer">
                        <div class="button" id="abortPassword">Abort download</div>
                    </div>
                    <div class="buttonContainer buttonMargin">
                        <div class="button" id="confirmPassword">Start download</div>
                    </div>
                </div>
            </div>
            <div class="restoreStep" id="step14">
                <div class="contentHeader headerMargin">
                    Download starting
                </div>
                <div id="step14box" class="textBox"></div>
                <div class="buttonSelectionContainer">
                    <div class="buttonContainer buttonMargin">
                        <div class="button" id="downloadStartingClosePopup">Close Popup</div>
                    </div>
                </div>
            </div>
            <div class="restoreStep" id="step8">
                <div class="contentHeader headerMargin">
                    Password needed
                </div>
                Create a password to encrypt your login information (token). If you forget this password, you can change it any time by simply logging in again in the tools & options tab.
                <br>
                <i>If you do not want to set a password simply leave it empty</i>
                <input type="password" id="passwordToken" placeholder="password">
                <div id="step8box" class="textBox"></div>
                <div class="buttonSelectionContainer">
                    <div class="buttonContainer buttonMargin">
                        <div class="button" id="tokenPassword">Create password for QuestAppVersionSwitcher</div>
                    </div>
                </div>
            </div>
            <div class="restoreStep" id="step9">
                <div class="contentHeader headerMargin">
                    Login info
                </div>
                To login we'll open auth.meta.com for you. Accept the cookies when you're asked to. Consenting to cookies is needed so you can log in.
                <br />
                <br />
                <b style="font-size: 1.1em;">You MUST login with your account which owns the games you want to downgrade.</b>
                <div id="step9box" class="textBox"></div>
                <div class="buttonSelectionContainer">
                    <div class="buttonContainer">
                        <div class="button" id="confirmLogin">Login</div>
                    </div>
                    <div class="buttonContainer buttonMargin">
                        <div class="button" id="abortLogin">Abort login</div>
                    </div>
                </div>
            </div>
            <div class="restoreStep" id="step10">
                <div class="contentHeader headerMargin">
                    Almost there
                </div>
                To finish logging in, you must restart QuestAppVersionSwitcher. Do that now.
                <div id="step10box" class="textBox"></div>
                <div class="buttonSelectionContainer">
                    <div class="buttonContainer">
                        <div class="button" id="closeApp">Close App</div>
                    </div>
                </div>
            </div>
            <div class="restoreStep" id="step11">
                <div class="contentHeader headerMargin">
                    Update Available
                </div>
                <div id="updateAvailableText" style="max-height: 50vh; overflow-y: scroll"></div>
                <div id="step11box" class="textBox"></div>
                <div class="buttonSelectionContainer">
                    <div class="buttonContainer">
                        <div class="button" id="updateqavs">Update QuestAppVersionSwitcher</div>
                    </div>
                    <div class="buttonContainer buttonMargin">
                        <div class="button" id="cancelupdate">Update later</div>
                    </div>
                </div>
            </div>

            <div id="step13" class="restoreStep hidden">
                <div class="contentHeader headerMargin">
                    Login
                </div>
                To downgrade your game you need to log into QuestAppVersionSwitcher with your Meta account. This is needed so you can download the old version of the game.
                <br>
                To downgrade press the login button below and login with your Meta account.
                <div id="step13box" class="textBox"></div>
                <div class="buttonSelectionContainer">
                    <div class="buttonContainer">
                        <div class="button" id="login2">Login</div>
                    </div>
                    <div class="buttonContainer buttonMargin">
                        <div class="button" id="cancellogin2">Abort downgrade</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="listContainer darken hidden" id="deleteContainer">
            <div class="restoreStep" id="step6">
                <div class="contentHeader headerMargin">
                    Confirm
                </div>
                Do you really want to delete <div class="selectedBackupName inline"></div> of <div class="inline packageName">some game</div>?
                <div class="buttonSelectionContainer">
                    <div class="buttonContainer">
                        <div class="button" id="abortDelete">No! Abort!</div>
                    </div>
                    <div class="buttonContainer buttonMargin">
                        <div class="button" id="delete">Yes. Delete the Backup</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="listContainer darken hidden" id="restoreContainer">
            <div id="step1" class="restoreStep">
                <div class="contentHeader headerMargin">
                    Step 1
                </div>
                <div><b>Restoring a backup will overwrite your current installation. If you do not want to lose your current installtion you <u>must</u> backup it first.<br>To do this abort the restore process and create a backup.</b></div>
                <br>
                <b>Selected backup:</b> <div class="selectedBackupName inline"></div> of <div class="inline packageName">some game</div>
                <br>
                As a first step of the restore process you need to uninstall your current installation.
                <br>
                <br>
                <i>The restore Process has to be done in headset</i>
                <div id="step1box" class="textBox"></div>
                <div class="buttonSelectionContainer">
                    <div class="buttonContainer">
                        <div class="button" id="abort">Abort Restore</div>
                    </div>
                    <div class="buttonContainer buttonMargin">
                        <div class="button" id="uninstall2">Start uninstall</div>
                    </div>
                </div>

            </div>
            <div id="step2" class="restoreStep hidden">
                <div class="contentHeader headerMargin">
                    Step 1.1
                </div>
                After the uninstall completed, press the continue button
                <br>
                <br>
                <i>If you didn't get a prompt then press continue as well</i>
                <div class="buttonSelectionContainer">
                    <div class="buttonContainer">
                        <div class="button" id="confirm1">Continue</div>
                    </div>
                </div>
            </div>
            <div id="step3" class="restoreStep hidden">
                <div class="contentHeader headerMargin">
                    Step 2
                </div>
                Now that you got the old version uninstalled, we can restore your backup!
                <br>
                We are going to install the app next.
                <br>Press the install button to start the installation.
                <br>If your Quest says <code>Package Installer isn't responding</code> simply press <code>close</code>
                <div id="step3box" class="textBox"></div>
                <div class="buttonSelectionContainer">
                    <div class="buttonContainer">
                        <div class="button" id="install">Install app</div>
                    </div>
                </div>
            </div>
            <div id="step4.1" class="restoreStep hidden">
                <div class="contentHeader headerMargin">
                    Step 2.1
                </div>
                Grant access permission
                <br>
                This will give QuestAppVersionSwitcher access to the games folder so it can install mods and restore app data and obbs.
                <br>
                Press <code>Use this folder</code> on both prompts you'll get after you press <code>Grant access</code>
                <div id="step4.1box" class="textBox"></div>
                <div class="buttonSelectionContainer">
                    <div class="buttonContainer">
                        <div class="button" id="grantAccess">Grant access</div>
                    </div>
                </div>
            </div>
            <div id="step4.2" class="restoreStep hidden">
                <div class="contentHeader headerMargin">
                    Step 2.2
                </div>
                Grant access storage permission
                <br>
                The modded game will most likely need access to your Quests storage.
                <br>
                To grant this access to the app press <code>Grant access</code> below
                <div id="step4.2box" class="textBox"></div>
                <div class="buttonSelectionContainer">
                    <div class="buttonContainer">
                        <div class="button" id="grantManageAccess">Grant access</div>
                    </div>
                </div>
            </div>
            <div id="step4" class="restoreStep hidden">
                <div class="contentHeader headerMargin">
                    Step 2.3
                </div>
                After you granted access to the folder, press the restore App Data button.
                <br>
                This will restore the app data and obbs you backed up. If you wish to not restore App Data and obbs simply press the skip button
                <div id="step4box" class="textBox"></div>
                <div class="buttonSelectionContainer">
                    <div class="buttonContainer">
                        <div class="button" id="restoreappdata">Restore App Data</div>
                    </div>
                    <div class="buttonContainer buttonMargin">
                        <div class="button" id="skip">Skip</div>
                    </div>
                </div>
            </div>
            <div id="step5" class="restoreStep hidden">
                <div class="contentHeader headerMargin">
                    Step 2.4
                </div>
                Press continue. We'll then validate, whether the backup was successfully restored.
                <div id="step5box" class="textBox"></div>
                <div class="buttonSelectionContainer">
                    <div class="buttonContainer buttonMargin">
                        <div class="button" id="skip2">continue</div>
                    </div>
                </div>
            </div>
            <div id="step6" class="restoreStep hidden">
                <div class="contentHeader headerMargin">
                    Finished!
                </div>
                You restored the backup <div class="slectedBackupName inline"></div> of <div class="inline packageName">some game</div>
                <div class="buttonSelectionContainer">
                    <div class="buttonContainer buttonMargin">
                        <div class="button" id="abort2">Close</div>
                    </div>
                </div>
            </div>
            <div id="step12" class="restoreStep hidden">
                <div class="contentHeader headerMargin">
                    Access needed
                </div>
                To create and restore backups, QuestAppVersionSwitcher needs access to Android data and obb folder. To grant access press <code>Grant access</code> below and press <code>Use this folder</code> on <b>both</b> prompts you'll get.
                <div id="step12box" class="textBox"></div>
                <div class="buttonSelectionContainer">
                    <div class="buttonContainer">
                        <div class="button" id="grantAccess2">Grant access</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="listContainer hidden" id="appListContainer">
            <div id="appList" class="list hidden">
            </div>
        </div>
    </div>
    
    <div id="toasts"></div>
    <script src="script.js"></script>
</body>
</html>